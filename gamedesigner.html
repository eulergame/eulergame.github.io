<!DOCTYPE html>
<html lang="en-us">
<head>
    <title>游戏策划</title>
    <meta charset="utf-8" />
    <meta name="description" content="游戏策划 tutorials">
    <meta name="keywords" content="游戏策划">
    <meta name="author" content="LaoZhang">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css" />
    <script type="text/javascript" async
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
</head>
<body>
    <p align="right">制心一处</p>
    <hr />
    <h1>角色等级基础属性</h1>
    PlayerBaseProp.csv

    <hr />
    <h1>角色属性</h1>
    <p>非战斗属性</p>
    <ul>
        <li>国家</li>
        <li>等级</li>
        <li>VIP</li>
        <li>战斗力</li>
        <li>经验</li>
    </ul>
    <p>战斗属性</p>
    <ul>
        <li>生命</li>
        <li>攻击</li>
        <li>防御</li>
        <li>物攻</li>
        <li>法攻</li>
        <li>物防</li>
        <li>法防</li>
        <li>暴击</li>
        <li>防爆</li>
        <li>格挡</li>
        <li>穿透</li>
        <li>闪避</li>
        <li>命中</li>
        <li>破甲</li>
        与伤害无关，用于击退
        <li>护甲</li>
        与伤害无关，用于击退
        <li>减伤</li>
        <li>加伤</li>
        <li>移动速度</li>
        <li>攻防全属性</li>
        <li>伤害点数</li>
        <li>攻击百分比</li>
        <li>忽视防御</li>
        <li>忽视防御百分比</li>


    </ul>
    <hr />

    <h1>战力</h1>
    <h2>战力系数</h2>
    <pre class="prettyprint">
    enum POWER_COEF
    {
        POWER_COEF_HP = 5,				        // 每点生命上限增加战斗力
        POWER_COEF_ATK = 100,                   // 每点攻击增加战斗力
        POWER_COEF_DEF = 200,				    // 每点防御增加战斗力
        POWER_COEF_PATK = 100,				    // 每点物理攻击增加战斗力
        POWER_COEF_MATK = 100,				    // 每点魔法攻击增加战斗力
        POWER_COEF_PDEF = 100,				    // 每点物理防御增加战斗力
        POWER_COEF_MDEF = 100,				    // 每点魔法防御增加战斗力
        POWER_COEF_CRITICAL_STRIKE = 1000,				// 每点暴击增加战斗力
        POWER_COEF_ANTI_CRITICAL_STRIKE = 1000,				// 每点防暴增加战斗力
        POWER_COEF_PARRY = 1000,				// 每点格挡增加战斗力
        POWER_COEF_ANTI_PARRY = 1000,				// 每点穿透增加战斗力
        POWER_COEF_DODGE = 1000,				// 每点闪避增加战斗力
        POWER_COEF_HIT = 1000,				// 每点命中增加战斗力
        POWER_COEF_ARMOR = 0,				// 每点护甲增加战斗力
        POWER_COEF_ANTI_ARMOR = 0,				// 每点破甲增加战斗力
        POWER_COEF_DAMAGE_REDUCTION = 100,				// 每点减伤增加战斗力
        POWER_COEF_DAMAGE_ADD = 100,				// 每点伤害加深增加战斗力
        POWER_COEF_SPD = 0,				// 每点移动速度增加战斗力
        POWER_COEF_ATK_DEF = 300,				// 每点全攻全防增加战斗力
        POWER_COEF_RATE = 5,				// 战斗力计算放大倍数
    };
    </pre>


    <h2>战力构成</h2>
    <p>由角色战斗属性乘以权重叠加而成</p>
    <pre class="prettyprint">
    int nPower =  m_nLevelPower + m_nEmblemPower + m_nMilitaryPower;
	for (int i = PLAYER_PARTID_NULL+1; i < PLAYER_PARTID_MAXID; i++)
	{
		IEntityPart* pEntityPart = GetEntityPart(i);
		IFNULL_CONTINUE(pEntityPart);
		nPower += pEntityPart->GetSelfPower(bRecalc);
	}
	nPower += CalcSuitPower();
    </pre>
    <ul>
        <li>
            等级战力
            <pre class="prettyprint">
    m_nLevelPower =
		( pBaseProp->dwBaseHP  * POWER_COEF_HP
		+ pBaseProp->dwBasePATK * POWER_COEF_PATK
		+ pBaseProp->dwBaseMATK * POWER_COEF_MATK
		+ pBaseProp->dwBasePDEF  * POWER_COEF_PDEF
		+ pBaseProp->dwBaseMDEF * POWER_COEF_MDEF
		+ pBaseProp->dwBaseCS * POWER_COEF_CRITICAL_STRIKE
		+ pBaseProp->dwBaseACS * POWER_COEF_ANTI_CRITICAL_STRIKE
		+ pBaseProp->dwBaseParry * POWER_COEF_ANTI_PARRY
		+ pBaseProp->dwAntiParry * POWER_COEF_ANTI_PARRY
		+ pBaseProp->dwDodge  * POWER_COEF_DODGE
		+ pBaseProp->dwHit * POWER_COEF_HIT
		+ pBaseProp->dwArmor * POWER_COEF_ARMOR
		+ pBaseProp->dwAntiArmor * POWER_COEF_ANTI_ARMOR
		+ pBaseProp->dwDamageReduction * POWER_COEF_DAMAGE_REDUCTION
		+ pBaseProp->dwDamageAdd * POWER_COEF_DAMAGE_ADD
		+ pBaseProp->dwMoveSpeed * POWER_COEF_SPD ) / POWER_COEF_RATE;
</pre>
        </li>
        <li>
            成就战力
            <pre class="prettyprint">
    m_nEmblemPower =
		(pAchieve->hp()  * POWER_COEF_HP
		+ pAchieve->attack() * POWER_COEF_ATK
		+ pAchieve->defense() * POWER_COEF_DEF
		+ pAchieve->physicsattack() * POWER_COEF_PATK
		+ pAchieve->magicattack() * POWER_COEF_MATK
		+ pAchieve->physicsdefense()  * POWER_COEF_PDEF
		+ pAchieve->magicdefense() * POWER_COEF_MDEF
		+ pAchieve->criticalstrike() * POWER_COEF_CRITICAL_STRIKE
		+ pAchieve->anticriticalstrike() * POWER_COEF_ANTI_CRITICAL_STRIKE
		+ pAchieve->parry() * POWER_COEF_ANTI_PARRY
		+ pAchieve->antiparry() * POWER_COEF_ANTI_PARRY
		+ pAchieve->dodge()  * POWER_COEF_DODGE
		+ pAchieve->hit() * POWER_COEF_HIT
		+ pAchieve->armor() * POWER_COEF_ARMOR
		+ pAchieve->antiarmor() * POWER_COEF_ANTI_ARMOR
		+ pAchieve->damagereduction() * POWER_COEF_DAMAGE_REDUCTION
		+ pAchieve->damageadd() * POWER_COEF_DAMAGE_ADD
		+ pAchieve->movespeed() * POWER_COEF_SPD
		+ pAchieve->attackdefense() * POWER_COEF_ATK_DEF) / POWER_COEF_RATE;
</pre>
        </li>
        <li>
            军衔战力
            <pre class="prettyprint">
    m_nMilitaryPower =
		(pMilitary->hp()  * POWER_COEF_HP
			+ pMilitary->attack() * POWER_COEF_ATK
			+ pMilitary->defense() * POWER_COEF_DEF
			+ pMilitary->physicsattack() * POWER_COEF_PATK
			+ pMilitary->magicattack() * POWER_COEF_MATK
			+ pMilitary->physicsdefense()  * POWER_COEF_PDEF
			+ pMilitary->magicdefense() * POWER_COEF_MDEF
			+ pMilitary->criticalstrike() * POWER_COEF_CRITICAL_STRIKE
			+ pMilitary->anticriticalstrike() * POWER_COEF_ANTI_CRITICAL_STRIKE
			+ pMilitary->parry() * POWER_COEF_ANTI_PARRY
			+ pMilitary->antiparry() * POWER_COEF_ANTI_PARRY
			+ pMilitary->dodge()  * POWER_COEF_DODGE
			+ pMilitary->hit() * POWER_COEF_HIT
			+ pMilitary->armor() * POWER_COEF_ARMOR
			+ pMilitary->antiarmor() * POWER_COEF_ANTI_ARMOR
			+ pMilitary->damagereduction() * POWER_COEF_DAMAGE_REDUCTION
			+ pMilitary->damageadd() * POWER_COEF_DAMAGE_ADD
			+ pMilitary->movespeed() * POWER_COEF_SPD
			+ pMilitary->attackdefense() * POWER_COEF_ATK_DEF) / POWER_COEF_RATE;
</pre>
        </li>
        <li>
            部件战力
            <ul>
                <li>背包部件    </li>
                <li>装备技能部件</li>
                <li>装备部件    </li>
                <li>神兵部件    </li>
                <li>逻辑部件    </li>
                <li>副本部件    </li>
                <li>技能部件    </li>
                <li>商店部件    </li>
                <li>帮会部件    </li>
                <li>时装部件    </li>
                <li>宝石部件    </li>
                <li>任务部件    </li>
                <li>仓库部件    </li>
                <li>新神兵部件  </li>
                <li>天赋部件    </li>
                <li>结婚部件    </li>
                <li>卡牌部件    </li>
                <li>生活技能部件</li>
                <li>坐骑部件    </li>
                <li>翅膀部件    </li>
                <li>buff部件   </li>
                <li>称号部件    </li>
                <li>特权卡部件  </li>
                <li>新翅膀部件  </li>
                <li>属性药部件  </li>
                <li>属性激活部件</li>
            </ul>
        </li>

        <li>套装战力</li>
    </ul>
    <hr />

    <h1>流派</h1>
    <pre class="prettyprint">
enum GENRE
{
	GENRE_NULL = 0,
	GENRE_SWORD,    // 流派-剑
	GENRE_PEN,      // 流派-笔
	GENRE_MAX,
};
</pre>

    <hr />
    <h1>角色数据的加载</h1>
    <p>三部分：角色数据、物品、任务</p>
    <pre class="prettyprint">
DBINPUT_LOAD_ACTOR_COMMAND dbInputCommand;
dbInputCommand.dwActorID = m_dwActorID;
if (!CDBSinkSingleton::Instance().ExecuteSP(m_dwActorID, SPID_LOAD_ACTOR_COMMAND, (LPCSTR)&dbInputCommand, sizeof(dbInputCommand)))
{
	_error("CTerminalStateLogin::OnEnter 请求角色常规数据失败，dwActorID=%d", m_dwActorID);
	return false;
}
DBINPUT_LOAD_ACTOR_GOODS dbInputGoods;	
dbInputGoods.dwActorID = m_dwActorID;
if (!CDBSinkSingleton::Instance().ExecuteSP(m_dwActorID, SPID_LOAD_ACTOR_GOODS, (LPCSTR)&dbInputGoods, sizeof(dbInputGoods)))
{
	_error("CTerminalStateLogin::OnEnter 请求角色物品数据失败，dwActorID=%d", m_dwActorID);
	return false;
}
DBINPUT_LOAD_ACTOR_TASK dbInputTask;	
dbInputTask.dwActorID = m_dwActorID;
if (!CDBSinkSingleton::Instance().ExecuteSP(m_dwActorID, SPID_LOAD_ACTOR_TASK, (LPCSTR)&dbInputTask, sizeof(dbInputTask)))
{
	_error("CTerminalStateLogin::OnEnter 请求角色任务数据失败，dwActorID=%d", m_dwActorID);
	return false;
}
</pre>
    <h1>篮子</h1>
    <p>角色可以拥有这么多篮子</p>
    <pre class="prettyprint">
enum SKEPID
{
	SKEPID_UNKNOW = 0,
	SKEPID_EQUIP,							// 装备栏(流派1-剑)
	SKEPID_PACKET,							// 背包栏
	SKEPID_WEAPON,							// 神兵栏
	SKEPID_FASHION,							// 时装栏
	SKEPID_GEMPACK,                         // 宝石背包
	SKEPID_GEMSTORAGE,                      // 宝石仓库
	SKEPID_WAREHORSE,						// 仓库
	SKEPID_GODWEAPON,						// 新神兵栏(流派1-剑)
	SKEPID_GODWEAPONSPIRIT,					// 灵件(流派1-剑)
	SKEPID_MONSTERCARD,						// 怪物卡牌
	SKEPID_MOUNT,							// 坐骑
	SKEPID_MOUNTEQUIP,						// 坐骑装备
	SKEPID_WING,							// 仙器
	SKEPID_WINGEQUIP,						// 仙器器魂
	SKEPID_ACTIVITYPACK,					// 活动背包
	SKEPID_TASKPACKET,						// 任务背包栏
	SKEPID_NEWWING,							// 羽翼背包
	SKEPID_MOUNTEQUIPPACKET,				// 坐骑装备背包
	SKEPID_EQUIP2,							// 装备栏(流派2-笔)
	SKEPID_GODWEAPON2,						// 新神兵栏(流派2-笔)
	SKEPID_GODWEAPONSPIRIT2,				// 灵件(流派2-笔)
	SKEPID_WINGEQUIPEXTRA,					// 仙器装备
	SKEPID_WINGEQUIPPACKET,					// 仙器装备背包
	SKEPID_NEWWINGEQUIP,					// 羽翼装备
	SKEPID_NEWWINGEQUIPPACKET,				// 羽翼装备背包
	SKEPID_WINGEQUIP2,						// 仙器器魂(流派2-笔)
	SKEPID_MAXID,
};
</pre>

    <h1>技能</h1>
    <h2>技能基础配置</h2>
    <p>Skill.csv</p>
    <ul>
        <li>ID 技能id</li>
        <li>Hit 命中</li>
        <li>AttackPoint 攻击点数</li>
        <li>AttackPercentage 攻击百分比</li>
        <li>IgnoreDefensePoint 忽视防御</li>
        <li>IgnoreDefensePercentage 忽视防御百分比</li>
        <li>DamagePoint 附加伤害</li>
        <li>DamagePercentage 附加伤害百分比</li>
        <li>CriticalPoint 暴击</li>
        <li>Pierce 穿透</li>
        <li>PhysicsOrMagic 1物攻 2法攻</li>

    </ul>
    <hr />















    <h2>技能等级配置</h2>
    <p>SkillEffect.csv</p>
    <ul>
        <li>Level 等级</li>
        <li>AttackPoint 攻击点数</li>
        <li>AttackPercentage 攻击百分比</li>
        <li>IgnoreDefensePoint 忽视防御</li>
        <li>IgnoreDefensePercentage 忽视防御百分比</li>
        <li>DamagePoint 附加伤害</li>
        <li>DamagePercentage 附加伤害百分比</li>
        <li>BreakPoint 破甲</li>
        <li>CriticalPoint 暴击</li>
        <li>Hit 命中</li>
        <li>Pierce 穿透</li>
    </ul>
    <hr />















    <h1>伤害公式</h1>
    <p>假设a打b</p>
    \[\text{let} \quad csMillionRev = 0.0001\]

    <p>命中</p>
    \[
    \text{let} \quad fHit = a.Hit - b.Dodge + Skill.Hit \times SkillEffect.Hit \times csMillionRev\\
    fHit=
    \begin{cases}
    fHit \times 0.1 + 95, & \quad fHit \gt -100\\
    fHit \times 0.06 + 85, & \quad fHit \gt -300\\
    fHit \times 0.01 + 73,& \quad \text{others}\\
    \end{cases}
    \\
    fHit = \max(fHit, 60)\\
    fHit = \min(fHit, 100)\\
    \]

    <p>闪避</p>
    \[\text{if} \quad random(0, 100) > fHit, \text{闪避成功，无伤害}\]

    <p>技能攻击</p>
    \[
    \text{let} \quad a1=
    \begin{cases}
    a.PhysicsAttack, & \quad Skill.PhysicsOrMagic == Physics\\
    a.MagicAttack, & \quad \text{others}
    \end{cases}\\

    \text{let} \quad A = (a1 + Skill.AttackPoint \times SkillEffect.AttackPoint \times csMillionRev) \times (1 + Skill.AttackPercentage \times SkillEffect.AttackPercentage \times csMillionRev^2)\\
    \]

    <p>目标防御</p>
    \[
    \text{let} \quad b1=
    \begin{cases}
    b.PhysicsDefense, & \quad Skill.PhysicsOrMagic == Physics\\
    b.MagicDefense, & \quad \text{others}
    \end{cases}\\

    \text{let} \quad B = b1 \times (1 - Skill.IgnoreDefensePercentage \times SkillEffect.IgnoreDefensePercentage \times csMillionRev)
    - Skill.IgnoreDefensePoint \times SkillEffect.IgnoreDefensePoint \times csMillionRev\\

    B = \max(0, B)
    \]

    <p>附加伤害百分比</p>
    \[
    \text{let} \quad y5=
    \begin{cases}
    \frac{Skill.DamagePercentage \times SkillEffect.DamagePercentage}{csMillionRev^2} , & \quad Skill.DamagePercentage \gt 0\\
    (Skill.DamagePercentage + SkillEffect.DamagePercentage) \times  csMillionRev, & \quad \text{others}
    \end{cases}\\

    \text{let} \quad C = y5 + a.DamageAdd \times csMillionRev + y5\\

    C = \max(0, C)
    \]

    <p>附加伤害点数</p>
    \[
    \text{let} \quad D = Skill.DamagePoint \times SkillEffect.DamagePoint \times csMillionRev\\
    \]

    <p>暴击</p>
    \[
    \text{let} \quad S = a.CriticalStrike + Skill.CriticalPoint \times SkillEffect.CriticalPoint \times csMillionRev
    - b.CriticalStrike\\
    \text{let} \quad SRate=
    \begin{cases}
    0, & \quad S \le 0\\
    S \times 0.001 + 0.06, & \quad S \le 100\\
    (S - 100) \times 0.0004 + 0.16, & \quad S \le 300\\
    (S - 300) \times 0.0002 + 0.24, & \quad S \le 1000\\
    \min(0.5, (S - 1000) \times 0.0001 + 0.38, & \quad \text{others}
    \end{cases}\\
    \]

    <p>格挡</p>
    \[
    \text{let} \quad P = b.Parry - Skill.Pierce \times SkillEffect.Pierce \times csMillionRev - a.AntiParry\\
    \text{let} \quad PRate=
    \begin{cases}
    \max(0, P \times 0.0003 + 0.06), & \quad P \le 0\\
    P \times 0.0012 + 0.06, & \quad P \le 100\\
    (P - 100) \times 0.0004 + 0.18, & \quad P \le 300\\
    (P - 300) \times 0.0002 + 0.26, & \quad P \le 1000\\
    \min(0.5, (P - 1000) \times 0.0001 + 0.4, & \quad \text{others}
    \end{cases}\\
    \]

    <p>伤害减免</p>
    \[
    \text{let} \quad E = C - b.DamageReduction \times csMillionRev - \min(1.5, P)\\
    E = max(0, E)
    \]

    <p>暴击伤害加成</p>
    \[
    \\
    \text{let} \quad G=1 + \max(S,0) \times 0.0002\\
    G=\min(G, 2)
    \\

    \text{let} \quad K=
    \begin{cases}
    A \times 1.5 - B, & \quad A \ge B\\
    \frac{A^2}{A \times 1.7 + B \times 0.3},& \quad \text{others}\\
    \end{cases}
    \\

    K = \max(0, K)
    \\
    \\
    \text{let} \quad F=
    \begin{cases}
    K, & \quad K \lt 2000\\
    2000 + (K - 2000) \times 0.5,& \quad K \lt 15000\\
    8500 + (K - 15000) \times 0.45,& \quad K \lt 50000\\
    26500 + (K - 50000) \times 0.35,& \quad K \lt 10000\\
    44000 + (K - 100000) \times 0.2,& \quad \text{others}\\
    \end{cases}
    \\
    \text{let} \quad H = \max((F+D) \times E \times G, 1) + \lfloor A \times 0.005 \times E \rfloor
    \\
    \text{let} \quad nDamAdd2 =
    \begin{cases}
    a.PlayerDamangeAdd, & \quad \text{a is player}\\
    a.MonsterDamangeAdd,& \quad \text{others}
    \end{cases}
    \\
    \text{if} \quad nDamAdd2 \gt 0, H = H \times (1 + nDamAdd2 \times csMillionRev)
    \\
    H=\min(H, 10000000)
    \]

    <p>暴击、格挡，随机</p>
    <p>\(\text{if} \quad random(0,1) \lt srate + prate\)</p>
    \[
    H=
    \begin{cases}
    H \times 1.5, \quad \text{if} \quad random(0,srate + prate) \lt srate\\
    H \times 0.5, \quad \text{others}
    \end{cases}
    \]

    <p>如果B是玩家，A也是玩家，分段伤害</p>
    \[H=
    \begin{cases}
    H \times 0.9 + 10, & \quad \frac{H}{b.MaxHP} \lt 0.12\\
    b.MaxHP \times 0.08, & \quad \frac{H}{b.MaxHP} \lt 0.15\\
    b.MaxHP \times 0.1, & \quad \frac{H}{b.MaxHP} \lt 0.3\\
    b.MaxHP \times 0.17, & \quad \frac{H}{b.MaxHP} \lt 1\\
    b.MaxHP \times 0.4, & \quad \frac{H}{b.MaxHP} \lt 3\\
    b.MaxHP \times 0.9, & \quad \text{others}
    \end{cases}
    \]
    \[H = H \times \min(1.25, \max(1, \frac{a.Power}{b.Power})) \]

    <p>如果B是玩家，A是怪物，秒杀保护</p>
    \[H = \min(H, b.MaxHP \times 0.9 + 10) \]

    <p>伤害整体调低</p>
    \[H = H \times 0.35 \]

    <p>浮动伤害</p>
    \[H = H \times random(0.9,1.1) \]

    <p>如果受击方B是怪物，可以设置伤害上限</p>
    \[H = \min(H,b.MaxHP \times monster.maxsinglehitdamange \times 0.0001) \]

    <p>最终伤害数值</p>
    \[H = \max(1,H) \]


    <hr />















    <h1>开服关服</h1>
    <p>开服   Bin/Cluster/开服.bat</p>
    <p>关服   Bin/Cluster/关服.bat</p>
    <p class="explain">
        * AgentServer是网关服，客户端通过tcp与之通信；DBServer是数据服，负责缓存数据，与数据库交互；SceneServer场景服，游戏的业务逻辑都在这里。CenterServer是中心服，负责服务器之间的消息中转。
    </p>

    <hr />















    <h1>导航网格</h1>
    <p>美术制作Unity场景test.unity</p>
    <p>依据场景地表，用插件(NavMesh Exension)构建TerrainMesh</p>
    <p class="explain">
        * 美术制作的场景地表，与策划期望的寻路地表是有差异的，所以用该插件来构建更合理的TerrainMesh
    </p>

    <p>在插件(NavMesh Exension) Bake NavMesh，会生成该场景的导航文件test/NavMesh.asset</p>
    <p class="explain">
        * 根据该TerrainMesh，生成Unity的导航网格，用于引擎寻路
    </p>

    <p>点击Unity菜单->Zen->同步导航网格文件到服务器</p>
    <p class="explain">
        * 怪物AI的寻路，需要在服务器完成，根据Untiy的NavMesh生成tiles，用于服务器A*寻路（todo 服务器也需要改成NavMesh寻路）
    </p>

    <p>该场景的导航网格制作流程完毕，重启服务器，测试完毕后可提交svn</p>

    <p class="explain">
        * 先根据策划构建的TerrainMesh拾取顶点A，再NavMesh.SamplePosition将A变换到Navmesh上的顶点B，B就是Navigation
        的Destination
    </p>


    <hr />















    <h1>怪物</h1>
    <hr />































    <h1>AI</h1>

    <hr />















    <h1>美术制作规范</h1>
    <h2>3DMax</h2>
    <p>system unit metric -> meters，基本长度单位是米，例如角色身高两米</p>
    <p>骨骼动画的骨头(bone)尽可能的少</p>


    <h2>角色</h2>
    <p>纹理尺寸：512x512</p>
    <h2>怪物</h2>
    <h2>NPC</h2>
    <h2>坐骑</h2>
    <h2>UI</h2>
    <h2>场景</h2>
    <h2>ICON</h2>
    <h2>宣传图</h2>
    <h2>特效</h2>
    <hr />















    <footer>
        <address>
            written by LaoZhang.<br />















            297191409@qq.com.<br />















            ShenZhen<br />















            China
        </address>
    </footer>

</body>
</html>
